
var mysql = require('mysql');
var fs = require('fs');
var filename = "createdb.sql";

/*
 Initialize a connection to the mysql
 change the dbuser and dbpasswd so that it is according to your setting.
 */
var db_server = 'localhost';
var db_name = "$db_name";
var db_user = "dbuser";
var db_password = "dbpasswd";

var db = mysql.createConnection({
    host: db_server,
    user: db_user,
    password: db_password,
});



var Wrapper = function() {
    this.init();
};

Wrapper.prototype.init = function() {
    var wrapper = this;
    db.connect(function(err){
        if (err) {
            console.log(err);
            process.exit(1);
        } 
        var sql1 = "CREATE DATABASE IF NOT EXISTS " + db_name;
        db.query(sql1, function (err, result) {
            if (err) {
                console.log(err);
                process.exit(1);
            } 
            console.log("Database created");
        });



        var sql2 = "use " + db_name;
        db.query(sql2,function(err, result){
             if (err) {
                console.log(err);
                process.exit(1);
            } 
            console.log('Connected successfully to database');
        });


        fs.open(filename,'r',function(err, fd){
            fs.writeFile(filename, sql1+";\n", function(err) {
                if(err) {
                    console.log(err);
                }
            });
            fs.appendFile(filename, sql2+";\n", function(err) {
            if(err) {
                console.log(err);
            }
            });
        });
        wrapper.db = db;
        });
};

module.exports = new Wrapper();
